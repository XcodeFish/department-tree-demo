---
description: 
globs: 
alwaysApply: true
---
# 部门树组件开发规则 (Development Rules)

## 基本规范
不重复创建函数、文件
使用MCP之前先看项目是否运行中，运行中则不重复运行，直接使用运行中的端口

## 1. 技术栈约束
- 必须基于Vue3 Composition API构建组件
- 必须使用Element Plus组件库并保持其设计风格
- 所有CSS必须使用SCSS编写，遵循Element Plus风格
- 必须支持Web Worker多线程处理大量数据计算

## 2. 性能优化规则
- 必须实现虚拟滚动，只渲染可见区域的节点
- 必须使用扁平化数据结构+Map索引实现O(1)复杂度节点查找
- 必须使用shallowRef处理大型数组数据以减少不必要的深层响应
- 必须实现可见性缓存机制避免重复计算
- 必须支持在8000+节点数据时保持58FPS以上流畅体验

## 3. 组件设计规则
- 严格遵循组件拆分结构：VirtualElTree、VirtualTreeNode等
- 所有业务逻辑必须从视图层分离，使用Composition API封装
- 组件必须提供清晰的props接口和emit事件
- 必须支持自定义节点渲染(使用插槽)

## 4. 代码质量规则
- 核心功能必须添加详细注释
- 复杂逻辑必须拆分为可测试和可复用的函数
- 避免在模板中使用复杂的内联表达式
- 使用JSDoc类型注释

## 5. 数据处理规则
- 树数据必须经过预处理转换为扁平结构
- 必须实现高效的搜索算法(支持在Worker中运行)
- 节点状态变化必须通过事件通知父组件

## 6. 功能要求规则
- 必须支持虚拟滚动与大数据渲染
- 必须支持搜索功能并高亮匹配结果
- 必须支持多选功能与选中状态管理
- 必须支持部门和人员节点不同的渲染样式
- 必须支持与Element Plus表单等组件的集成

## 7. 性能监控规则
- 必须实现性能监控组件，展示FPS、内存使用等指标
- 必须在性能模式下将计算任务迁移到Worker线程
- 必须实现自动缓冲区大小调整以适应不同设备

## 8. 用户体验规则
- 必须实现加载状态和空数据状态展示
- 必须支持键盘导航
- 必须优化移动端交互体验
- 必须遵循Element Plus的设计语言

## 9. 开发流程规则
- 必须按照开发计划中的4天进度开发
- 每个功能模块完成后必须进行性能测试
- 必须先完成核心树组件再集成业务功能

## 10. 测试验证规则
- 必须在不同节点数量(1000, 5000, 8000+)下测试性能表现
- 必须验证Worker模式和非Worker模式的性能差异
- 必须测试内存占用是否符合优化目标(降低82%以上)

请根据以上规则约束和引导AI开发，确保最终实现的部门树组件符合高性能、易用性和业务适配性的要求。